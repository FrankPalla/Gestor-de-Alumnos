<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestiÃ³n de Alumnos</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ“š GestiÃ³n de Alumnos</h1>

        <!-- Barra de bÃºsqueda -->
        <input type="text" id="search" placeholder="Buscar alumno..." oninput="searchStudent()">

        <!-- Formulario para agregar/editando estudiantes -->
        <form id="studentForm">
            <div class="input-group">
                <label for="name">ğŸ‘¤ Nombre del Alumno:</label>
                <input type="text" id="name" placeholder="Ej: Juan PÃ©rez" required>
            </div>
            <div class="input-group">
                <label for="phone">ğŸ“ TelÃ©fono:</label>
                <input type="text" id="phone" placeholder="Ej: 123456789" required>
            </div>
            <div class="input-group">
                <label for="entryDate">ğŸ“… Fecha de Ingreso:</label>
                <input type="date" id="entryDate" required>
            </div>
            <div class="input-group">
                <label for="paymentDate">ğŸ’° Fecha de Pago:</label>
                <input type="date" id="paymentDate" required>
            </div>
            <div class="input-group">
                <label for="supportType">ğŸ“– Tipo de AtenciÃ³n:</label>
                <select id="supportType" required onchange="toggleSubjectField()">
                    <option value="">Seleccionar...</option>
                    <option value="Apoyo escolar">Apoyo Escolar</option>
                    <option value="Materia puntual">Materia Puntual</option>
                </select>
            </div>
            <div class="input-group" id="subjectField" style="display: none;">
                <label for="subject">ğŸ“š Materia a EnseÃ±ar:</label>
                <input type="text" id="subject" placeholder="Ej: MatemÃ¡ticas">
            </div>
            <div class="input-group">
                <label for="price">ğŸ’² Precio:</label>
                <input type="number" id="price" placeholder="Ej: 1500" required>
            </div>
            <button type="submit" class="btn">â• Agregar Alumno</button>
        </form>

        <!-- Alertas de Ã©xito/error -->
        <div class="alert success" id="successMessage" style="display:none;">Estudiante agregado exitosamente.</div>
        <div class="alert error" id="errorMessage" style="display:none;">Hubo un error al agregar el estudiante.</div>

        <!-- Tabla de estudiantes -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>TelÃ©fono</th>
                        <th>Fecha de Ingreso</th>
                        <th>Fecha de Pago</th>
                        <th>Tipo de AtenciÃ³n</th>
                        <th>Precio</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="studentList"></tbody>
            </table>
        </div>

        <!-- SecciÃ³n de Pagos -->
        <h2>ğŸ’° GestiÃ³n de Pagos</h2>
        <table class="table-payments">
            <thead>
                <tr>
                    <th>Estudiante</th>
                    <th class="payment-col amount">Monto</th>
                    <th class="payment-col due-date">Fecha de vencimiento</th>
                    <th>AcciÃ³n</th>
                </tr>
            </thead>
            <tbody id="paymentsTable"></tbody>
        </table>

        <!-- Formulario de pagos -->
        <div class="payment-form">
            <input type="text" id="paymentStudent" placeholder="Nombre del estudiante" required>
            <input type="number" id="paymentAmount" placeholder="Monto del pago" required>
            <input type="date" id="paymentDueDate" placeholder="Fecha de vencimiento" required>
            <button type="submit" id="payButton">Registrar Pago</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const studentForm = document.getElementById("studentForm");
            const studentList = document.getElementById("studentList");
            const paymentsTable = document.getElementById("paymentsTable");
            let students = JSON.parse(localStorage.getItem("students")) || [];
            let payments = JSON.parse(localStorage.getItem("payments")) || [];

            function saveToLocalStorage() {
                localStorage.setItem("students", JSON.stringify(students));
                localStorage.setItem("payments", JSON.stringify(payments));
            }

            function displayStudents() {
                studentList.innerHTML = "";
                students.forEach((student, index) => {
                    let row = document.createElement("tr");

                    // Compara la fecha de pago con la fecha actual
                    const currentDate = new Date();
                    const paymentDate = new Date(student.paymentDate);
                    const isPaymentOverdue = paymentDate < currentDate;

                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.phone}</td>
                        <td>${student.entryDate}</td>
                        <td class="payment-date ${isPaymentOverdue ? 'overdue' : ''}">${student.paymentDate}</td>
                        <td>${student.attentionDetail}</td>
                        <td>${student.price.toFixed(2)}</td>
                        <td>
                            <button class="edit" onclick="editStudent(${index})">âœï¸</button>
                            <button class="delete" onclick="deleteStudent(${index})">âŒ</button>
                        </td>
                    `;
                    studentList.appendChild(row);
                });
            }

            function displayPayments() {
                paymentsTable.innerHTML = "";
                payments.forEach(payment => {
                    let row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${payment.studentName}</td>
                        <td>${payment.amount.toFixed(2)}</td>
                        <td>${payment.dueDate}</td>
                        <td>
                            <button class="delete" onclick="deletePayment(${payment.studentName})">âŒ</button>
                        </td>
                    `;
                    paymentsTable.appendChild(row);
                });
            }

            // FunciÃ³n para eliminar un estudiante
            window.deleteStudent = function(index) {
                students.splice(index, 1);
                saveToLocalStorage();
                displayStudents();
            };

            // FunciÃ³n para editar un estudiante
            window.editStudent = function(index) {
                const student = students[index];
                document.getElementById("name").value = student.name;
                document.getElementById("phone").value = student.phone;
                document.getElementById("entryDate").value = student.entryDate;
                document.getElementById("paymentDate").value = student.paymentDate;
                document.getElementById("supportType").value = student.attentionDetail;
                document.getElementById("price").value = student.price;
                document.getElementById("subject").value = student.subject || "";

                studentForm.onsubmit = function(event) {
                    event.preventDefault();
                    students[index] = {
                        name: document.getElementById("name").value,
                        phone: document.getElementById("phone").value,
                        entryDate: document.getElementById("entryDate").value,
                        paymentDate: document.getElementById("paymentDate").value,
                        attentionDetail: document.getElementById("supportType").value,
                        price: parseFloat(document.getElementById("price").value),
                        subject: document.getElementById("subject").value
                    };
                    saveToLocalStorage();
                    displayStudents();
                    studentForm.reset();
                };
            };

            // FunciÃ³n para filtrar estudiantes por bÃºsqueda
            window.searchStudent = function() {
                const query = document.getElementById("search").value.toLowerCase();
                const filteredStudents = students.filter(student => 
                    student.name.toLowerCase().includes(query)
                );
                displayFilteredStudents(filteredStudents);
            };

            function displayFilteredStudents(filteredStudents) {
                studentList.innerHTML = "";
                filteredStudents.forEach((student, index) => {
                    let row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.phone}</td>
                        <td>${student.entryDate}</td>
                        <td class="payment-date">${student.paymentDate}</td>
                        <td>${student.attentionDetail}</td>
                        <td>${student.price.toFixed(2)}</td>
                        <td>
                            <button class="edit" onclick="editStudent(${index})">âœï¸</button>
                            <button class="delete" onclick="deleteStudent(${index})">âŒ</button>
                        </td>
                    `;
                    studentList.appendChild(row);
                });
            }

            // Guardar el nuevo estudiante
            studentForm.addEventListener("submit", function(event) {
                event.preventDefault();

                let name = document.getElementById("name").value.trim();
                let phone = document.getElementById("phone").value.trim();
                let entryDate = document.getElementById("entryDate").value;
                let paymentDate = document.getElementById("paymentDate").value;
                let supportType = document.getElementById("supportType").value;
                let subject = document.getElementById("subject").value.trim();
                let price = parseFloat(document.getElementById("price").value) || 0;

                if (!name || !phone || !entryDate || !paymentDate || !supportType || price <= 0) {
                    alert("Por favor, completa todos los campos correctamente.");
                    return;
                }

                if (supportType === "Materia puntual" && !subject) {
                    alert("Por favor, ingresa la materia a enseÃ±ar.");
                    return;
                }

                let attentionDetail = (supportType === "Materia puntual") ? `${supportType} (${subject})` : supportType;

                let student = { name, phone, entryDate, paymentDate, attentionDetail, price };
                students.push(student);
                saveToLocalStorage();
                displayStudents();

                studentForm.reset();
                toggleSubjectField(); // Oculta el campo de materia si es necesario
            });

            // Mostrar u ocultar el campo de materia segÃºn el tipo de atenciÃ³n
            window.toggleSubjectField = function() {
                const supportType = document.getElementById("supportType").value;
                const subjectField = document.getElementById("subjectField");
                subjectField.style.display = (supportType === "Materia puntual") ? "block" : "none";
            };

            // FunciÃ³n para registrar el pago de un estudiante
            document.getElementById("payButton").addEventListener("click", function(event) {
                event.preventDefault();

                let studentName = document.getElementById("paymentStudent").value.trim();
                let amount = parseFloat(document.getElementById("paymentAmount").value);
                let dueDate = document.getElementById("paymentDueDate").value;

                if (!studentName || amount <= 0 || !dueDate) {
                    alert("Por favor, completa todos los campos correctamente.");
                    return;
                }

                let payment = { studentName, amount, dueDate };
                payments.push(payment);
                saveToLocalStorage();
                displayPayments();

                document.getElementById("paymentStudent").value = "";
                document.getElementById("paymentAmount").value = "";
                document.getElementById("paymentDueDate").value = "";
            });

            // FunciÃ³n para eliminar un pago
            window.deletePayment = function(studentName) {
                payments = payments.filter(payment => payment.studentName !== studentName);
                saveToLocalStorage();
                displayPayments();
            };

            window.onload = () => {
                displayStudents();
                displayPayments();
            };
        });
    </script>
</body>
</html>
